**8.MEDIA RECOVERY介质恢复**  
我们假定介质恢复是在文件层面或者类似的层面（比如DB空间，表空间等等）。使用模糊镜像备份（页称之为模糊文件归档）来生成该实例，与此同时其他事务也可以操作该实例。由于这个是一个高并发镜像备份方法，该镜像备份中可能包含一些未提交的更新，与【52】中的方法恰恰相反。当然，如果需要的话，可以很容易的生成一个没有未提交变更的镜像备份。在此，我们假设该镜像备份是直接取自于非易事存储的某个版本。这就意味着某些备份页的最新版本还在事务系统的缓存中。在进行这样的备份操作时，由于可以使用设备的特性并节省了缓存管理的消耗，所以从非易失存储中备份将会十分高效。由于事务系统不需要直接处理备份，所以这比从其缓存中备份要容易的多。如果确实需要后者（比如，【13】中描述的支持增量镜像备份），页很容易修改现有的方法来支持它。当然，如果这样的话，将会需要一些少量的同步操作。比如，在页层面加闩，不需要加锁。  
在模糊镜像备份开始时，将会记录最近一次完成检测点的begin_chkpt的位置，并且与镜像备份数据记录在一起。我们称其为镜像备份checkpoint。基于此checkpoint信息可以得知：那些LSN比min(min(该checkpoint的脏页中的RecLSN),LSN(该checkpoint的bigen_chkpt))的日志记录，在开始镜像备份操作时已经刷出到非易失存储上了。这样，该实例的镜像版本至少与此是日志中最新的。我们成此刻为media recovery redo point（介质恢复重做点）。在介质重做点中计算beign_chkpt中LSN的原因和5.4节中讨论计算restart redo point的所给的原因一样。  
若要开始介质恢复了，就会装载其镜像备份版本，并且从介质恢复重做点开始redo遍历。在redo遍历时，所有涉及到正在恢复实例的日志记录都会被处理，并执行相应的更新操作，